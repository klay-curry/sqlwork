## 🤖 Assistant

# 网上商城系统课程设计任务书（修订增强版）

> **课程名称**：大数据存储与管理
> **适用专业**：人工智能、计算机科学与技术等相关专业
> **开发周期**：2–3人小组，2周
> **提交形式**：课程设计报告 + 可运行系统源码 + 演示视频（可选）

---

## 一、设计目的

本课程设计旨在通过开发一个融合**AI能力**的网上商城系统，综合运用以下能力：

1. **数据库建模与操作**：熟练使用 MySQL 构建关系型数据模型；
2. **全栈开发能力**：采用明确的技术栈实现前后端分离架构；
3. **数据可视化能力**：将业务数据以图表形式直观呈现；
4. **AI算法集成能力**：结合协同过滤推荐、LLM智能建议等技术，体现人工智能专业特色；
5. **工程化思维**：完成从需求分析到部署测试的完整软件开发生命周期。

---

## 二、技术栈明确说明

| 层级                 | 技术选型                                                 | 说明                                  |
| -------------------- | -------------------------------------------------------- | ------------------------------------- |
| **后端语言**   | **Python 3.9+**                                    | 统一使用 Python 便于 AI 模块集成      |
| **后端框架**   | **FastAPI**                                        | 高性能、自动生成 API 文档、异步支持好 |
| **数据库**     | **MySQL 8.0**                                      | 关系型，支持事务、复杂查询            |
| **前端语言**   | **JavaScript (ES6+)**                              | 标准 Web 开发语言                     |
| **前端框架**   | **Vue 3 + Element Plus**                           | 组件丰富、开发效率高                  |
| **可视化库**   | **ECharts 5.x**                                    | 支持饼图、柱状图、折线图等交互式图表  |
| **AI模块语言** | **Python 3.9+**                                    | 与后端一致，便于调用                  |
| **AI依赖库**   | `scikit-learn`, `surprise`, `transformers`（可选） | 实现推荐算法与 LLM 调用               |
| **部署方式**   | Docker Compose（可选）                                   | 后端 + MySQL + 前端 Nginx 容器化      |

> **统一使用 Python 后端**，避免 Java/Python 混合带来的通信复杂度，同时便于 AI 模块直接嵌入或本地调用。

---

## 三、核心功能函数详细定义（含接口与返回格式）

### （1）商家端功能（需身份认证）

#### ✅ `GET /api/merchant/products`

- **描述**：获取当前商家所有商品列表
- **请求头**：`Authorization: Bearer <token>`
- **返回 JSON**：

```json
  {
    "code": 200,
    "data": [
      {
        "product_id": 1001,
        "name": "无线蓝牙耳机",
        "price": 299.00,
        "stock": 150,
        "sales_count": 87,
        "category": "数码",
        "status": "上架",
        "created_at": "2025-11-01T10:00:00"
      }
    ]
  }
```

#### ✅ `GET /api/merchant/orders`

- **描述**：获取该商家所有订单（按交易时间倒序）
- **返回字段**：订单ID、买家用户名、商品名、数量、单价、总金额、交易时间、状态

#### ✅ `GET /api/merchant/sales/trend?days=30`

- **描述**：近 N 天每日销量趋势（用于折线图）
- **返回格式**：
  ```json
  {
    "dates": ["2025-12-01", "2025-12-02", ...],
    "sales": [12, 18, 9, ...]
  }
  ```

#### ✅ `GET /api/merchant/products/top?limit=10`

- **描述**：销量 Top N 商品（用于柱状图）
- **返回格式**：
  ```json
  [
    {"name": "蓝牙耳机", "sales": 87},
    {"name": "充电宝", "sales": 65}
  ]
  ```

#### ✅ `GET /api/merchant/category/distribution`

- **描述**：各商品类目销量占比（用于饼图）
- **返回格式**：
  ```json
  [
    {"name": "数码", "value": 60},
    {"name": "服饰", "value": 25},
    {"name": "家居", "value": 15}
  ]
  ```

---

### （2）买家端功能（需登录）

#### ✅ `GET /api/user/orders`

- **描述**：获取当前用户所有历史订单
- **返回字段**：订单ID、商品名、商家名、单价、数量、总金额、交易时间、是否已评价

#### ✅ `GET /api/user/recommendations`

- **描述**：基于协同过滤的个性化商品推荐（见下文 AI 推荐模块）
- **返回格式**：商品列表（同商品列表结构）

#### ✅ `POST /api/user/search`

- **请求体**：`{"keyword": "耳机"}`
- **描述**：模糊搜索商品（支持名称、描述）

---

### （3）通用功能（无需登录）

#### ✅ `GET /api/products?page=1&size=10`

- **描述**：分页获取所有上架商品

#### ✅ `GET /api/categories`

- **描述**：获取所有商品类目

---

## 四、AI 功能模块设计（多维度融合）

> 不再局限于“LLM 给建议”，而是构建 **双路径 AI 能力**：
>
> - **面向商家**：经营洞察 + 策略建议（LLM + 规则引擎）
> - **面向买家**：个性化推荐（协同过滤算法）

---

### 4.1 买家侧：个性化商品推荐（协同过滤）

#### 算法选型

- **基于物品的协同过滤（Item-Based CF）**：更适合电商场景，稳定性高
- 使用 **Surprise 库** 实现，支持余弦相似度计算

#### 数据输入

- 用户-商品交互矩阵（来自订单表）：
  - 用户ID、商品ID、购买次数（可作为隐式评分）
- 商品元数据（用于冷启动补充）

#### 接口实现

```python
# ai/recommender.py
def get_user_recommendations(user_id: int, top_n=10) -> List[Dict]:
 # 1. 加载用户行为数据（从 MySQL 查询）
 # 2. 构建评分矩阵（购买=1，未购买=0 或 缺失）
 # 3. 训练 Item-Based KNN 模型
 # 4. 预测用户对未购商品的兴趣分
 # 5. 返回 top_n 商品ID列表
 # 6. 查询商品详情并返回
```

#### 调用时机

- 用户登录后首页“猜你喜欢”模块
- 商品详情页底部“看了又看”/“买了也买”

---

### 4.2 商家侧：智能经营建议（多策略融合）

#### 策略 1：规则引擎 + LLM（轻量级）

- **触发条件**：每日定时任务 or 商家访问数据看板
- **输入特征**：
- 近7天销量 vs 前7天（环比）
- 库存周转率
- 同类目平均价格
- 是否有促销活动
- **提示词模板**：

```text
你是一位资深电商运营专家。商家「{merchant_name}」主营「{category}」。
其商品「{product_name}」近7天销量为 {recent_sales}，环比变化 {change_pct}%，
当前库存 {stock}，同类商品均价 ¥{avg_price}。
请用一句话给出可执行的经营建议（不超过50字）。
```

- **输出示例**：“销量下滑15%，建议设置限时9折促销清库存。”

#### 策略 2：竞品监控（可选扩展）

- 若系统有多个商家卖同类商品，可计算：
- “您的商品价格比竞品高 12%”
- “竞品A近3天销量增长 40%，可能因参与平台活动”

#### 策略 3：复购预测（进阶）

- 对消耗品（如牙膏、纸巾），基于用户购买周期预测下次购买时间
- 主动推送“即将用完？一键补货”提醒

---

## 五、数据库表结构（MySQL）

### 用户表 `users`

| 字段          | 类型               | 说明        |
| ------------- | ------------------ | ----------- |
| user_id       | BIGINT PK          | 自增主键    |
| username      | VARCHAR(50) UNIQUE | 用户名      |
| password_hash | VARCHAR(128)       | bcrypt 加密 |
| email         | VARCHAR(100)       | 邮箱        |
| phone         | VARCHAR(15)        | 手机号      |
| created_at    | DATETIME           | 注册时间    |

### 商家表 `merchants`

| 字段           | 类型         | 说明                      |
| -------------- | ------------ | ------------------------- |
| merchant_id    | BIGINT PK    | 主键（与 user_id 可关联） |
| name           | VARCHAR(100) | 商家名称                  |
| contact_person | VARCHAR(50)  | 联系人                    |
| phone          | VARCHAR(15)  | 联系电话                  |
| registered_at  | DATETIME     | 入驻时间                  |

### 商品表 `products`

| 字段        | 类型          | 说明               |
| ----------- | ------------- | ------------------ |
| product_id  | BIGINT PK     | 商品ID             |
| merchant_id | BIGINT FK     | 所属商家           |
| name        | VARCHAR(100)  | 商品名             |
| description | TEXT          | 描述               |
| price       | DECIMAL(10,2) | 价格               |
| stock       | INT           | 库存               |
| category    | VARCHAR(50)   | 类目（如“数码”） |
| status      | TINYINT       | 1=上架, 2=下架     |
| created_at  | DATETIME      | 上架时间           |

### 订单表 `orders`

| 字段         | 类型          | 说明       |
| ------------ | ------------- | ---------- |
| order_id     | BIGINT PK     | 订单ID     |
| user_id      | BIGINT FK     | 买家       |
| product_id   | BIGINT FK     | 商品       |
| merchant_id  | BIGINT FK     | 商家       |
| quantity     | INT           | 数量       |
| unit_price   | DECIMAL(10,2) | 下单时单价 |
| total_amount | DECIMAL(10,2) | 总价       |
| order_time   | DATETIME      | 下单时间   |
| status       | VARCHAR(20)   | 状态       |
| review       | TEXT          | 评价内容   |

---

## 六、交付要求更新

- **必须包含 AI 推荐模块代码**（`ai/recommender.py`）
- **必须包含 LLM 建议生成逻辑**（可模拟，不强制调用真实 API）
- **前端需展示推荐商品区块**（“猜你喜欢”）
- **商家后台需显示 AI 建议文本**

---

> **备注**：本方案通过 **Item-Based 协同过滤**解决买家推荐问题，通过 **规则+LLM**解决商家决策问题，形成完整的“AI 双轮驱动”电商系统，充分体现人工智能专业特色，同时保持技术可行性与课程目标一致性。
