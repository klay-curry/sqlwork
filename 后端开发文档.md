# ç½‘ä¸Šå•†åŸç³»ç»Ÿ - åç«¯å¼€å‘æ–‡æ¡£

> åŸºäº FastAPI + MySQL + AIç®—æ³• çš„é«˜æ€§èƒ½ç”µå•†åç«¯ç³»ç»Ÿ

---

## ğŸ“‹ ç›®å½•

1. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
2. [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
3. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
6. [AIç®—æ³•å®ç°](#aiç®—æ³•å®ç°)
7. [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
8. [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)
9. [æµ‹è¯•æŒ‡å—](#æµ‹è¯•æŒ‡å—)

---

## æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

#### åç«¯æ¡†æ¶
- **FastAPI 0.109.0** - ç°ä»£åŒ–çš„Python Webæ¡†æ¶
- **Uvicorn 0.27.0** - ASGIæœåŠ¡å™¨
- **Pydantic 2.5.3** - æ•°æ®éªŒè¯

#### æ•°æ®åº“
- **MySQL 8.0** - å…³ç³»å‹æ•°æ®åº“
- **SQLAlchemy 2.0.25** - ORMæ¡†æ¶
- **PyMySQL 1.1.0** - MySQLé©±åŠ¨

#### è®¤è¯å®‰å…¨
- **python-jose 3.3.0** - JWT Tokenç”Ÿæˆ
- **passlib[bcrypt] 1.7.4** - å¯†ç åŠ å¯†
- **cryptography 42.0.0** - åŠ å¯†æ”¯æŒ

#### AIç®—æ³•åº“
- **scikit-learn 1.4.0** - æœºå™¨å­¦ä¹ åº“
- **pandas 2.2.0** - æ•°æ®å¤„ç†
- **numpy 1.26.3** - æ•°å€¼è®¡ç®—

#### å…¶ä»–ä¾èµ–
- **pydantic-settings 2.1.0** - é…ç½®ç®¡ç†
- **python-dotenv 1.0.0** - ç¯å¢ƒå˜é‡
- **email-validator 2.1.1** - é‚®ç®±éªŒè¯
- **python-multipart 0.0.6** - æ–‡ä»¶ä¸Šä¼ 

### æ¶æ„è®¾è®¡æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API Layer (FastAPI)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Auth   â”‚Merchant â”‚  User   â”‚ Common  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Service Layer (ä¸šåŠ¡é€»è¾‘)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Auth Service   â”‚   AI Service        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Data Layer (SQLAlchemy ORM)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Users â”‚Merch.â”‚ Products â”‚   Orders   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  MySQL 8.0  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶
- **Python**: 3.9 æˆ–æ›´é«˜ç‰ˆæœ¬
- **MySQL**: 8.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **pip**: æœ€æ–°ç‰ˆæœ¬

### å¯é€‰è½¯ä»¶
- **Docker**: ç”¨äºå®¹å™¨åŒ–éƒ¨ç½²
- **Postman**: APIæµ‹è¯•å·¥å…·
- **MySQL Workbench**: æ•°æ®åº“ç®¡ç†

### ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version

# æ£€æŸ¥pipç‰ˆæœ¬
pip --version

# æ£€æŸ¥MySQLæœåŠ¡
mysql --version
```

---

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ api/                        # APIè·¯ç”±æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py            # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ auth.py                # è®¤è¯æ¥å£ï¼ˆ156è¡Œï¼‰
â”‚   â”œâ”€â”€ merchant.py            # å•†å®¶ç«¯æ¥å£ï¼ˆ340è¡Œï¼‰
â”‚   â”œâ”€â”€ user.py                # ä¹°å®¶ç«¯æ¥å£ï¼ˆ200è¡Œï¼‰
â”‚   â””â”€â”€ common.py              # é€šç”¨æ¥å£ï¼ˆ172è¡Œï¼‰
â”‚
â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py            # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ models.py              # ORMæ¨¡å‹ï¼ˆ4ä¸ªè¡¨ï¼‰
â”‚   â””â”€â”€ schemas.py             # Pydantic Schemaï¼ˆ20+ä¸ªï¼‰
â”‚
â”œâ”€â”€ services/                   # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ __init__.py            # åŒ…åˆå§‹åŒ–
â”‚   â””â”€â”€ auth.py                # è®¤è¯æœåŠ¡ï¼ˆJWTã€å¯†ç åŠ å¯†ï¼‰
â”‚
â”œâ”€â”€ ai/                         # AIæ™ºèƒ½æ¨¡å— â­
â”‚   â”œâ”€â”€ __init__.py            # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ recommender.py         # ååŒè¿‡æ»¤æ¨èå¼•æ“ï¼ˆ241è¡Œï¼‰
â”‚   â””â”€â”€ advisor.py             # AIç»è¥å»ºè®®ç”Ÿæˆå™¨ï¼ˆ211è¡Œï¼‰
â”‚
â”œâ”€â”€ config.py                   # é…ç½®ç®¡ç†ï¼ˆ35è¡Œï¼‰
â”œâ”€â”€ database.py                 # æ•°æ®åº“è¿æ¥ï¼ˆ34è¡Œï¼‰
â”œâ”€â”€ main.py                     # FastAPIåº”ç”¨å…¥å£ï¼ˆ69è¡Œï¼‰
â”œâ”€â”€ test_api.py                 # APIè‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆ354è¡Œï¼‰
â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–ï¼ˆ16ä¸ªåŒ…ï¼‰
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ Dockerfile                  # Dockeré•œåƒæ„å»ºæ–‡ä»¶
```

### ä»£ç ç»Ÿè®¡
| æ¨¡å— | æ–‡ä»¶æ•° | ä»£ç è¡Œæ•° | è¯´æ˜ |
|------|--------|----------|------|
| APIè·¯ç”± | 4 | ~1,100 | 22ä¸ªRESTæ¥å£ |
| æ•°æ®æ¨¡å‹ | 2 | ~350 | ORMæ¨¡å‹ + Pydantic Schema |
| AIæ¨¡å— | 2 | ~450 | æ¨èç®—æ³• + å»ºè®®ç”Ÿæˆ |
| æœåŠ¡å±‚ | 1 | ~220 | è®¤è¯ä¸æƒé™ |
| é…ç½® | 2 | ~70 | æ•°æ®åº“ + åº”ç”¨é…ç½® |
| æµ‹è¯• | 1 | ~350 | è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ |
| **æ€»è®¡** | **12** | **~2,540è¡Œ** | |

---

## æ•°æ®åº“è®¾è®¡

### ERå…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  users  â”‚1      N â”‚ orders  â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚N
                         â”‚
                         â”‚1
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚products â”‚
                    â”‚         â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚N
                         â”‚
                         â”‚1
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚merchantsâ”‚
                    â”‚         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¡¨ç»“æ„è¯¦ç»†è¯´æ˜

#### 1. usersï¼ˆç”¨æˆ·è¡¨ï¼‰
```sql
CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    phone VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_username (username)
);
```

**å­—æ®µè¯´æ˜**ï¼š
- `user_id`: ä¸»é”®ï¼Œè‡ªå¢
- `username`: ç”¨æˆ·åï¼Œå”¯ä¸€ç´¢å¼•
- `password_hash`: bcryptåŠ å¯†çš„å¯†ç 
- `email`: é‚®ç®±åœ°å€
- `phone`: æ‰‹æœºå·
- `created_at`: æ³¨å†Œæ—¶é—´

#### 2. merchantsï¼ˆå•†å®¶è¡¨ï¼‰
```sql
CREATE TABLE merchants (
    merchant_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    contact_person VARCHAR(50),
    phone VARCHAR(20),
    registered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_name (name)
);
```

**å­—æ®µè¯´æ˜**ï¼š
- `merchant_id`: ä¸»é”®ï¼Œè‡ªå¢
- `name`: å•†å®¶åç§°ï¼Œå”¯ä¸€ç´¢å¼•
- `password_hash`: bcryptåŠ å¯†çš„å¯†ç 
- `contact_person`: è”ç³»äºº
- `phone`: è”ç³»ç”µè¯
- `registered_at`: æ³¨å†Œæ—¶é—´

#### 3. productsï¼ˆå•†å“è¡¨ï¼‰
```sql
CREATE TABLE products (
    product_id INT PRIMARY KEY AUTO_INCREMENT,
    merchant_id INT NOT NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10, 2) NOT NULL,
    stock INT NOT NULL DEFAULT 0,
    category VARCHAR(50),
    status TINYINT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (merchant_id) REFERENCES merchants(merchant_id),
    INDEX idx_merchant (merchant_id),
    INDEX idx_category (category),
    INDEX idx_status (status),
    FULLTEXT INDEX idx_name_desc (name, description)
);
```

**å­—æ®µè¯´æ˜**ï¼š
- `product_id`: ä¸»é”®ï¼Œè‡ªå¢
- `merchant_id`: å•†å®¶IDï¼Œå¤–é”®
- `name`: å•†å“åç§°
- `description`: å•†å“æè¿°
- `price`: ä»·æ ¼ï¼ˆç²¾ç¡®åˆ°åˆ†ï¼‰
- `stock`: åº“å­˜æ•°é‡
- `category`: ç±»ç›®
- `status`: çŠ¶æ€ï¼ˆ1=ä¸Šæ¶ï¼Œ2=ä¸‹æ¶ï¼‰
- `created_at`: åˆ›å»ºæ—¶é—´

**ç´¢å¼•è¯´æ˜**ï¼š
- ç»„åˆç´¢å¼•ï¼šmerchant_id
- ç±»ç›®ç´¢å¼•ï¼šcategory
- çŠ¶æ€ç´¢å¼•ï¼šstatus
- å…¨æ–‡ç´¢å¼•ï¼šname + descriptionï¼ˆæ”¯æŒå•†å“æœç´¢ï¼‰

#### 4. ordersï¼ˆè®¢å•è¡¨ï¼‰
```sql
CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    product_id INT NOT NULL,
    merchant_id INT NOT NULL,
    quantity INT NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,
    total_amount DECIMAL(10, 2),
    order_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status VARCHAR(20) DEFAULT 'pending',
    review TEXT,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (product_id) REFERENCES products(product_id),
    FOREIGN KEY (merchant_id) REFERENCES merchants(merchant_id),
    INDEX idx_user (user_id),
    INDEX idx_product (product_id),
    INDEX idx_merchant (merchant_id),
    INDEX idx_order_time (order_time)
);
```

**å­—æ®µè¯´æ˜**ï¼š
- `order_id`: ä¸»é”®ï¼Œè‡ªå¢
- `user_id`: ç”¨æˆ·IDï¼Œå¤–é”®
- `product_id`: å•†å“IDï¼Œå¤–é”®
- `merchant_id`: å•†å®¶IDï¼Œå¤–é”®
- `quantity`: è´­ä¹°æ•°é‡
- `unit_price`: å•ä»·
- `total_amount`: æ€»é‡‘é¢ï¼ˆç”±è§¦å‘å™¨è‡ªåŠ¨è®¡ç®—ï¼‰
- `order_time`: ä¸‹å•æ—¶é—´
- `status`: è®¢å•çŠ¶æ€
- `review`: è¯„ä»·

### è§¦å‘å™¨

#### 1. è®¢å•é‡‘é¢è‡ªåŠ¨è®¡ç®—
```sql
CREATE TRIGGER before_order_insert
BEFORE INSERT ON orders
FOR EACH ROW
SET NEW.total_amount = NEW.quantity * NEW.unit_price;
```

#### 2. è®¢å•æ›´æ–°æ—¶é‡ç®—é‡‘é¢
```sql
CREATE TRIGGER before_order_update
BEFORE UPDATE ON orders
FOR EACH ROW
SET NEW.total_amount = NEW.quantity * NEW.unit_price;
```

### è§†å›¾

#### å•†å“é”€é‡ç»Ÿè®¡è§†å›¾
```sql
CREATE VIEW product_sales_stats AS
SELECT 
    p.product_id,
    p.name,
    p.category,
    p.merchant_id,
    COALESCE(SUM(o.quantity), 0) AS total_sales,
    COALESCE(SUM(o.total_amount), 0) AS total_revenue
FROM products p
LEFT JOIN orders o ON p.product_id = o.product_id
GROUP BY p.product_id;
```

---

## æ ¸å¿ƒæ¨¡å—

### 1. é…ç½®ç®¡ç† (config.py)

```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # æ•°æ®åº“é…ç½®
    DATABASE_URL: str = "mysql+pymysql://root:123456@localhost:3306/online_mall"
    
    # JWTé…ç½®
    SECRET_KEY: str = "your-secret-key-here-change-in-production"
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 1440  # 24å°æ—¶
    
    # CORSé…ç½®
    CORS_ORIGINS: list = [
        "http://localhost:5173",
        "http://localhost:3000",
    ]
    
    class Config:
        env_file = ".env"

settings = Settings()
```

### 2. æ•°æ®åº“è¿æ¥ (database.py)

```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from config import settings

# åˆ›å»ºæ•°æ®åº“å¼•æ“
engine = create_engine(
    settings.DATABASE_URL,
    pool_pre_ping=True,      # è¿æ¥æ± å¥åº·æ£€æŸ¥
    pool_recycle=3600,       # è¿æ¥å›æ”¶æ—¶é—´
    echo=False               # ç”Ÿäº§ç¯å¢ƒå…³é—­SQLæ—¥å¿—
)

# åˆ›å»ºä¼šè¯å·¥å‚
SessionLocal = sessionmaker(
    autocommit=False,
    autoflush=False,
    bind=engine
)

# åˆ›å»ºåŸºç±»
Base = declarative_base()

# æ•°æ®åº“ä¾èµ–æ³¨å…¥
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

### 3. ORMæ¨¡å‹ (models/models.py)

```python
from sqlalchemy import Column, Integer, String, DECIMAL, Text, TIMESTAMP, ForeignKey, Index
from sqlalchemy.sql import func
from database import Base

class User(Base):
    __tablename__ = "users"
    
    user_id = Column(Integer, primary_key=True, autoincrement=True)
    username = Column(String(50), unique=True, nullable=False, index=True)
    password_hash = Column(String(255), nullable=False)
    email = Column(String(100))
    phone = Column(String(20))
    created_at = Column(TIMESTAMP, server_default=func.now())

class Merchant(Base):
    __tablename__ = "merchants"
    
    merchant_id = Column(Integer, primary_key=True, autoincrement=True)
    name = Column(String(100), unique=True, nullable=False, index=True)
    password_hash = Column(String(255), nullable=False)
    contact_person = Column(String(50))
    phone = Column(String(20))
    registered_at = Column(TIMESTAMP, server_default=func.now())

class Product(Base):
    __tablename__ = "products"
    
    product_id = Column(Integer, primary_key=True, autoincrement=True)
    merchant_id = Column(Integer, ForeignKey('merchants.merchant_id'), nullable=False)
    name = Column(String(200), nullable=False)
    description = Column(Text)
    price = Column(DECIMAL(10, 2), nullable=False)
    stock = Column(Integer, nullable=False, default=0)
    category = Column(String(50), index=True)
    status = Column(Integer, default=1)
    created_at = Column(TIMESTAMP, server_default=func.now())
    
    __table_args__ = (
        Index('idx_merchant', 'merchant_id'),
        Index('idx_category', 'category'),
    )

class Order(Base):
    __tablename__ = "orders"
    
    order_id = Column(Integer, primary_key=True, autoincrement=True)
    user_id = Column(Integer, ForeignKey('users.user_id'), nullable=False)
    product_id = Column(Integer, ForeignKey('products.product_id'), nullable=False)
    merchant_id = Column(Integer, ForeignKey('merchants.merchant_id'), nullable=False)
    quantity = Column(Integer, nullable=False)
    unit_price = Column(DECIMAL(10, 2), nullable=False)
    total_amount = Column(DECIMAL(10, 2))
    order_time = Column(TIMESTAMP, server_default=func.now())
    status = Column(String(20), default='pending')
    review = Column(Text)
    
    __table_args__ = (
        Index('idx_user', 'user_id'),
        Index('idx_product', 'product_id'),
        Index('idx_merchant', 'merchant_id'),
    )
```

### 4. è®¤è¯æœåŠ¡ (services/auth.py)

```python
from datetime import datetime, timedelta
from jose import JWTError, jwt
from passlib.context import CryptContext
from config import settings

# å¯†ç åŠ å¯†ä¸Šä¸‹æ–‡
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def hash_password(password: str) -> str:
    """å¯†ç åŠ å¯†"""
    return pwd_context.hash(password)

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """éªŒè¯å¯†ç """
    return pwd_context.verify(plain_password, hashed_password)

def create_access_token(data: dict) -> str:
    """åˆ›å»ºJWT Token"""
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode.update({"exp": expire})
    
    encoded_jwt = jwt.encode(
        to_encode,
        settings.SECRET_KEY,
        algorithm=settings.ALGORITHM
    )
    return encoded_jwt

def verify_token(token: str) -> dict:
    """éªŒè¯JWT Token"""
    try:
        payload = jwt.decode(
            token,
            settings.SECRET_KEY,
            algorithms=[settings.ALGORITHM]
        )
        return payload
    except JWTError:
        return None
```

### 5. FastAPIåº”ç”¨å…¥å£ (main.py)

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from config import settings
from api import auth, merchant, user, common

# åˆ›å»ºFastAPIåº”ç”¨
app = FastAPI(
    title="ç½‘ä¸Šå•†åŸç³»ç»ŸAPI",
    description="åŸºäºFastAPI + MySQL + AIçš„ç”µå•†åç«¯ç³»ç»Ÿ",
    version="1.0.0",
    docs_url="/docs",
    redoc_url="/redoc"
)

# é…ç½®CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# æ³¨å†Œè·¯ç”±
app.include_router(auth.router, prefix="/api/auth", tags=["è®¤è¯"])
app.include_router(merchant.router, prefix="/api/merchant", tags=["å•†å®¶ç«¯"])
app.include_router(user.router, prefix="/api/user", tags=["ä¹°å®¶ç«¯"])
app.include_router(common.router, prefix="/api", tags=["é€šç”¨æ¥å£"])

# å¥åº·æ£€æŸ¥
@app.get("/health")
async def health_check():
    return {"status": "healthy", "database": "connected"}

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

---

## AIç®—æ³•å®ç°

### 1. ååŒè¿‡æ»¤æ¨èå¼•æ“ (ai/recommender.py)

#### ç®—æ³•åŸç†
**Item-Based Collaborative Filteringï¼ˆåŸºäºç‰©å“çš„ååŒè¿‡æ»¤ï¼‰**

1. **æ„å»ºç”¨æˆ·-å•†å“è¯„åˆ†çŸ©é˜µ**
   - ä»è®¢å•è¡¨æå–ç”¨æˆ·è´­ä¹°å†å²
   - è´­ä¹°æ¬¡æ•°ä½œä¸ºéšå¼è¯„åˆ†

2. **è®¡ç®—å•†å“ç›¸ä¼¼åº¦çŸ©é˜µ**
   - ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—
   - å…¬å¼ï¼š`similarity = dot(A, B) / (norm(A) * norm(B))`

3. **ç”Ÿæˆæ¨èåˆ—è¡¨**
   - åŸºäºç”¨æˆ·å·²è´­å•†å“æ‰¾ç›¸ä¼¼å•†å“
   - æ’é™¤å·²è´­ä¹°çš„å•†å“
   - æŒ‰ç›¸ä¼¼åº¦æ’åº

4. **å†·å¯åŠ¨ç­–ç•¥**
   - æ–°ç”¨æˆ·æ— å†å²ï¼šè¿”å›çƒ­é—¨å•†å“
   - é˜ˆå€¼ï¼šè‡³å°‘è´­ä¹°2ä»¶å•†å“

#### æ ¸å¿ƒä»£ç 

```python
import pandas as pd
import numpy as np
from sklearn.metrics.pairwise import cosine_similarity
from sqlalchemy.orm import Session
from models.models import Order, Product

class ProductRecommender:
    def __init__(self, db: Session):
        self.db = db
        self.user_item_matrix = None
        self.item_similarity = None
    
    def build_user_item_matrix(self):
        """æ„å»ºç”¨æˆ·-å•†å“è¯„åˆ†çŸ©é˜µ"""
        # ä»æ•°æ®åº“è·å–è®¢å•æ•°æ®
        orders = self.db.query(
            Order.user_id,
            Order.product_id,
            Order.quantity
        ).all()
        
        # è½¬æ¢ä¸ºDataFrame
        df = pd.DataFrame(orders, columns=['user_id', 'product_id', 'quantity'])
        
        # èšåˆåŒä¸€ç”¨æˆ·è´­ä¹°åŒä¸€å•†å“çš„æ•°é‡
        df = df.groupby(['user_id', 'product_id'])['quantity'].sum().reset_index()
        
        # åˆ›å»ºè¯„åˆ†çŸ©é˜µï¼ˆpivot tableï¼‰
        self.user_item_matrix = df.pivot(
            index='user_id',
            columns='product_id',
            values='quantity'
        ).fillna(0)
        
        return self.user_item_matrix
    
    def calculate_item_similarity(self):
        """è®¡ç®—å•†å“ç›¸ä¼¼åº¦çŸ©é˜µ"""
        if self.user_item_matrix is None:
            self.build_user_item_matrix()
        
        # è½¬ç½®çŸ©é˜µï¼ˆè¡Œä¸ºå•†å“ï¼Œåˆ—ä¸ºç”¨æˆ·ï¼‰
        item_user_matrix = self.user_item_matrix.T
        
        # è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
        self.item_similarity = cosine_similarity(item_user_matrix)
        
        # è½¬æ¢ä¸ºDataFrameä¾¿äºç´¢å¼•
        self.item_similarity_df = pd.DataFrame(
            self.item_similarity,
            index=item_user_matrix.index,
            columns=item_user_matrix.index
        )
        
        return self.item_similarity_df
    
    def recommend_for_user(self, user_id: int, top_n: int = 10):
        """ä¸ºç”¨æˆ·ç”Ÿæˆæ¨èåˆ—è¡¨"""
        # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è´­ä¹°å†å²
        user_orders = self.db.query(Order).filter(
            Order.user_id == user_id
        ).all()
        
        if len(user_orders) < 2:
            # å†·å¯åŠ¨ï¼šè¿”å›çƒ­é—¨å•†å“
            return self._get_hot_products(top_n)
        
        # æ„å»ºç›¸ä¼¼åº¦çŸ©é˜µ
        if self.item_similarity_df is None:
            self.calculate_item_similarity()
        
        # è·å–ç”¨æˆ·å·²è´­å•†å“
        user_products = [order.product_id for order in user_orders]
        
        # è®¡ç®—æ¨èåˆ†æ•°
        recommendations = {}
        for product_id in user_products:
            if product_id not in self.item_similarity_df.index:
                continue
            
            # è·å–ç›¸ä¼¼å•†å“
            similar_items = self.item_similarity_df[product_id].sort_values(ascending=False)
            
            for item_id, similarity in similar_items.items():
                if item_id not in user_products:  # æ’é™¤å·²è´­å•†å“
                    if item_id not in recommendations:
                        recommendations[item_id] = 0
                    recommendations[item_id] += similarity
        
        # æ’åºå¹¶è¿”å›Top N
        sorted_recommendations = sorted(
            recommendations.items(),
            key=lambda x: x[1],
            reverse=True
        )[:top_n]
        
        # è·å–å•†å“è¯¦æƒ…
        product_ids = [item[0] for item in sorted_recommendations]
        products = self.db.query(Product).filter(
            Product.product_id.in_(product_ids)
        ).all()
        
        return products
    
    def _get_hot_products(self, limit: int):
        """è·å–çƒ­é—¨å•†å“ï¼ˆå†·å¯åŠ¨ç­–ç•¥ï¼‰"""
        hot_products = self.db.query(
            Product.product_id,
            Product.name,
            Product.price,
            Product.category,
            func.sum(Order.quantity).label('total_sales')
        ).join(
            Order, Product.product_id == Order.product_id
        ).group_by(
            Product.product_id
        ).order_by(
            func.sum(Order.quantity).desc()
        ).limit(limit).all()
        
        return hot_products
```

### 2. AIç»è¥å»ºè®®ç³»ç»Ÿ (ai/advisor.py)

#### è§„åˆ™å¼•æ“è®¾è®¡

| è§„åˆ™åç§° | è§¦å‘æ¡ä»¶ | ä¼˜å…ˆçº§ | å»ºè®®ç¤ºä¾‹ |
|---------|---------|--------|----------|
| åº“å­˜é¢„è­¦ | å‘¨è½¬ç‡>2 AND åº“å­˜<æœˆé”€Ã—0.3 | HIGH | "é¢„è®¡5å¤©å”®ç½„ï¼Œå»ºè®®åŠæ—¶è¡¥è´§" |
| æ»é”€é¢„è­¦ | è¿‘7å¤©é›¶é”€é‡ AND åº“å­˜>50 | MEDIUM | "å»ºè®®é™ä»·ä¿ƒé”€æˆ–ä¼˜åŒ–æè¿°" |
| ä¿ƒé”€å»ºè®® | ç¯æ¯”ä¸‹æ»‘>10% AND å‘¨è½¬ç‡<0.5 | MEDIUM | "é”€é‡ä¸‹æ»‘15%ï¼Œå»ºè®®é™æ—¶æŠ˜æ‰£" |
| æä»·æœºä¼š | ç¯æ¯”å¢é•¿>20% AND ä»·æ ¼<å‡ä»·Ã—0.9 | LOW | "å¯é€‚å½“æä»·å¢åŠ åˆ©æ¶¦" |
| åº“å­˜ç®¡ç† | å‘¨è½¬ç‡<0.2 AND åº“å­˜>200 | MEDIUM | "å‘¨è½¬ç‡ä½ï¼Œå»ºè®®ä¼˜åŒ–åº“å­˜" |
| è¡¥è´§å»ºè®® | å‘¨è½¬ç‡>1.5 AND åº“å­˜<50 | LOW | "é”€å”®è‰¯å¥½ï¼Œå»ºè®®å¢åŠ å¤‡è´§" |

#### æ ¸å¿ƒä»£ç 

```python
from datetime import datetime, timedelta
from sqlalchemy import func
from sqlalchemy.orm import Session
from models.models import Product, Order

class BusinessAdvisor:
    def __init__(self, db: Session, merchant_id: int):
        self.db = db
        self.merchant_id = merchant_id
    
    def generate_suggestions(self):
        """ç”ŸæˆAIç»è¥å»ºè®®"""
        suggestions = []
        
        # è·å–å•†å®¶çš„æ‰€æœ‰å•†å“
        products = self.db.query(Product).filter(
            Product.merchant_id == self.merchant_id
        ).all()
        
        for product in products:
            # è®¡ç®—å„é¡¹æŒ‡æ ‡
            metrics = self._calculate_metrics(product.product_id)
            
            # åº”ç”¨è§„åˆ™å¼•æ“
            product_suggestions = self._apply_rules(product, metrics)
            
            if product_suggestions:
                suggestions.extend(product_suggestions)
        
        # æŒ‰ä¼˜å…ˆçº§æ’åº
        priority_order = {'high': 0, 'medium': 1, 'low': 2}
        suggestions.sort(key=lambda x: priority_order.get(x['priority'], 3))
        
        return suggestions
    
    def _calculate_metrics(self, product_id: int):
        """è®¡ç®—å•†å“æŒ‡æ ‡"""
        now = datetime.now()
        week_ago = now - timedelta(days=7)
        two_weeks_ago = now - timedelta(days=14)
        month_ago = now - timedelta(days=30)
        
        # è¿‘7å¤©é”€é‡
        recent_sales = self.db.query(
            func.coalesce(func.sum(Order.quantity), 0)
        ).filter(
            Order.product_id == product_id,
            Order.order_time >= week_ago
        ).scalar()
        
        # å‰7å¤©é”€é‡ï¼ˆç”¨äºç¯æ¯”è®¡ç®—ï¼‰
        previous_sales = self.db.query(
            func.coalesce(func.sum(Order.quantity), 0)
        ).filter(
            Order.product_id == product_id,
            Order.order_time >= two_weeks_ago,
            Order.order_time < week_ago
        ).scalar()
        
        # è¿‘30å¤©é”€é‡
        month_sales = self.db.query(
            func.coalesce(func.sum(Order.quantity), 0)
        ).filter(
            Order.product_id == product_id,
            Order.order_time >= month_ago
        ).scalar()
        
        # è·å–å•†å“ä¿¡æ¯
        product = self.db.query(Product).filter(
            Product.product_id == product_id
        ).first()
        
        # è®¡ç®—ç¯æ¯”å˜åŒ–ç‡
        if previous_sales > 0:
            change_pct = ((recent_sales - previous_sales) / previous_sales) * 100
        else:
            change_pct = 0 if recent_sales == 0 else 100
        
        # è®¡ç®—å‘¨è½¬ç‡ï¼ˆæœˆé”€é‡ / å½“å‰åº“å­˜ï¼‰
        turnover_rate = month_sales / product.stock if product.stock > 0 else 0
        
        return {
            'recent_sales': recent_sales,
            'previous_sales': previous_sales,
            'month_sales': month_sales,
            'change_pct': change_pct,
            'turnover_rate': turnover_rate,
            'current_stock': product.stock,
            'price': float(product.price)
        }
    
    def _apply_rules(self, product, metrics):
        """åº”ç”¨è§„åˆ™å¼•æ“"""
        suggestions = []
        
        # è§„åˆ™1: åº“å­˜é¢„è­¦
        if metrics['turnover_rate'] > 2 and metrics['current_stock'] < metrics['month_sales'] * 0.3:
            days_left = int(metrics['current_stock'] / (metrics['recent_sales'] / 7))
            suggestions.append({
                'product_id': product.product_id,
                'product_name': product.name,
                'suggestion': f"åº“å­˜ä¸è¶³ï¼Œé¢„è®¡{days_left}å¤©å”®ç½„ï¼Œå»ºè®®åŠæ—¶è¡¥è´§",
                'priority': 'high',
                'metrics': metrics
            })
        
        # è§„åˆ™2: æ»é”€é¢„è­¦
        if metrics['recent_sales'] == 0 and metrics['current_stock'] > 50:
            suggestions.append({
                'product_id': product.product_id,
                'product_name': product.name,
                'suggestion': "è¿‘æœŸé›¶é”€é‡ï¼Œå»ºè®®é™ä»·ä¿ƒé”€æˆ–ä¼˜åŒ–å•†å“æè¿°",
                'priority': 'medium',
                'metrics': metrics
            })
        
        # è§„åˆ™3: ä¿ƒé”€å»ºè®®
        if metrics['change_pct'] < -10 and metrics['turnover_rate'] < 0.5:
            suggestions.append({
                'product_id': product.product_id,
                'product_name': product.name,
                'suggestion': f"é”€é‡ç¯æ¯”ä¸‹æ»‘{abs(metrics['change_pct']):.1f}%ï¼Œå»ºè®®æ¨å‡ºé™æ—¶æŠ˜æ‰£",
                'priority': 'medium',
                'metrics': metrics
            })
        
        # è§„åˆ™4: æä»·æœºä¼š
        category_avg_price = self._get_category_avg_price(product.category)
        if (metrics['change_pct'] > 20 and 
            metrics['price'] < category_avg_price * 0.9):
            suggestions.append({
                'product_id': product.product_id,
                'product_name': product.name,
                'suggestion': "å•†å“çƒ­é”€ä¸”ä»·æ ¼ä½äºåŒç±»å‡ä»·ï¼Œå¯é€‚å½“æä»·å¢åŠ åˆ©æ¶¦",
                'priority': 'low',
                'metrics': metrics
            })
        
        # è§„åˆ™5: åº“å­˜ç®¡ç†
        if metrics['turnover_rate'] < 0.2 and metrics['current_stock'] > 200:
            suggestions.append({
                'product_id': product.product_id,
                'product_name': product.name,
                'suggestion': "åº“å­˜å‘¨è½¬ç‡ä½ï¼Œå»ºè®®ä¼˜åŒ–åº“å­˜ç®¡ç†",
                'priority': 'medium',
                'metrics': metrics
            })
        
        # è§„åˆ™6: è¡¥è´§å»ºè®®
        if metrics['turnover_rate'] > 1.5 and metrics['current_stock'] < 50:
            suggestions.append({
                'product_id': product.product_id,
                'product_name': product.name,
                'suggestion': "å•†å“é”€å”®è‰¯å¥½ï¼Œå»ºè®®å¢åŠ å¤‡è´§é‡",
                'priority': 'low',
                'metrics': metrics
            })
        
        return suggestions
    
    def _get_category_avg_price(self, category: str):
        """è·å–ç±»ç›®å¹³å‡ä»·æ ¼"""
        avg_price = self.db.query(
            func.avg(Product.price)
        ).filter(
            Product.category == category
        ).scalar()
        
        return float(avg_price) if avg_price else 0
```

---

## APIæ¥å£æ–‡æ¡£

### æ¥å£æ¦‚è§ˆ

| åˆ†ç±» | æ¥å£æ•°é‡ | è¯´æ˜ |
|------|---------|------|
| è®¤è¯æ¥å£ | 3 | æ³¨å†Œã€ç™»å½• |
| å•†å®¶ç«¯æ¥å£ | 11 | å•†å“ç®¡ç†ã€æ•°æ®ç»Ÿè®¡ã€AIå»ºè®® |
| ä¹°å®¶ç«¯æ¥å£ | 4 | è®¢å•ã€æœç´¢ã€æ¨è |
| é€šç”¨æ¥å£ | 4 | å•†å“æµè§ˆã€çƒ­é”€æ¦œ |
| **æ€»è®¡** | **22** | |

### è®¤è¯æ¥å£

#### 1. ç”¨æˆ·æ³¨å†Œ
```http
POST /api/auth/register/user
Content-Type: application/json

{
  "username": "zhang_san",
  "password": "password123",
  "email": "zhangsan@example.com",
  "phone": "13800138001"
}

Response 201:
{
  "user_id": 6,
  "username": "zhang_san",
  "email": "zhangsan@example.com",
  "created_at": "2025-12-26T10:30:00"
}
```

#### 2. å•†å®¶æ³¨å†Œ
```http
POST /api/auth/register/merchant
Content-Type: application/json

{
  "name": "æµ‹è¯•å•†å®¶",
  "password": "merchant123",
  "contact_person": "å¼ ç»ç†",
  "phone": "13900139000"
}

Response 201:
{
  "merchant_id": 5,
  "name": "æµ‹è¯•å•†å®¶",
  "contact_person": "å¼ ç»ç†",
  "registered_at": "2025-12-26T10:30:00"
}
```

#### 3. ç»Ÿä¸€ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "zhang_san",
  "password": "password123",
  "role": "user"  // æˆ– "merchant"
}

Response 200:
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "expires_in": 86400
}
```

### å•†å®¶ç«¯æ¥å£ï¼ˆéœ€è®¤è¯ï¼‰

#### 4. è·å–å•†å“åˆ—è¡¨
```http
GET /api/merchant/products?page=1&size=20
Authorization: Bearer {token}

Response 200:
{
  "code": 200,
  "data": {
    "items": [...],
    "total": 30,
    "page": 1,
    "size": 20
  }
}
```

#### 5. åˆ›å»ºå•†å“
```http
POST /api/merchant/products
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "æ–°å•†å“",
  "description": "å•†å“æè¿°",
  "price": 99.99,
  "stock": 100,
  "category": "æ•°ç "
}

Response 201:
{
  "code": 200,
  "data": {
    "product_id": 31,
    "name": "æ–°å•†å“",
    ...
  }
}
```

#### 6. è·å–é”€å”®è¶‹åŠ¿
```http
GET /api/merchant/sales/trend?days=30
Authorization: Bearer {token}

Response 200:
{
  "code": 200,
  "data": {
    "dates": ["2025-11-27", "2025-11-28", ...],
    "sales": [15, 23, 18, ...]
  }
}
```

#### 7. è·å–AIç»è¥å»ºè®® â­
```http
GET /api/merchant/ai/suggestions
Authorization: Bearer {token}

Response 200:
{
  "code": 200,
  "data": {
    "suggestions": [
      {
        "product_id": 3,
        "product_name": "å……ç”µå®20000æ¯«å®‰",
        "suggestion": "åº“å­˜ä¸è¶³ï¼Œé¢„è®¡5å¤©å”®ç½„ï¼Œå»ºè®®åŠæ—¶è¡¥è´§",
        "priority": "high",
        "metrics": {
          "recent_sales": 15,
          "change_pct": 25.5,
          "turnover_rate": 2.3
        }
      }
    ]
  }
}
```

### ä¹°å®¶ç«¯æ¥å£ï¼ˆéœ€è®¤è¯ï¼‰

#### 8. åˆ›å»ºè®¢å•
```http
POST /api/user/orders
Authorization: Bearer {token}
Content-Type: application/json

{
  "product_id": 1,
  "quantity": 2
}

Response 201:
{
  "code": 200,
  "message": "è®¢å•åˆ›å»ºæˆåŠŸ",
  "data": {
    "order_id": 34,
    "total_amount": 19998.00
  }
}
```

#### 9. è·å–ä¸ªæ€§åŒ–æ¨è â­
```http
GET /api/user/recommendations?limit=10
Authorization: Bearer {token}

Response 200:
{
  "code": 200,
  "data": [
    {
      "product_id": 5,
      "name": "æ— çº¿é¼ æ ‡",
      "price": 89.00,
      "category": "æ•°ç ",
      "merchant_name": "æ•°ç ä¸“è¥åº—",
      "reason": "åŸºäºæ‚¨çš„è´­ä¹°å†å²æ¨è"
    }
  ]
}
```

### é€šç”¨æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰

#### 10. è·å–å•†å“åˆ—è¡¨
```http
GET /api/products?page=1&size=20&category=æ•°ç 

Response 200:
{
  "code": 200,
  "data": {
    "items": [...],
    "total": 30,
    "page": 1,
    "size": 20
  }
}
```

#### 11. è·å–çƒ­é”€å•†å“
```http
GET /api/hot-products?limit=10

Response 200:
{
  "code": 200,
  "data": [
    {
      "product_id": 1,
      "name": "iPhone 15 Pro",
      "price": 9999.00,
      "total_sales": 50
    }
  ]
}
```

---

## éƒ¨ç½²æ–¹æ¡ˆ

### æœ¬åœ°å¼€å‘éƒ¨ç½²

#### 1. å®‰è£…ä¾èµ–
```bash
cd backend
pip install -r requirements.txt
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘.envæ–‡ä»¶
DATABASE_URL=mysql+pymysql://root:your_password@localhost:3306/online_mall
SECRET_KEY=your-secret-key-here
```

#### 3. åˆå§‹åŒ–æ•°æ®åº“
```bash
mysql -u root -p < ../database/schema.sql
mysql -u root -p < ../database/seed_data.sql
```

#### 4. å¯åŠ¨æœåŠ¡
```bash
# æ–¹å¼1: ç›´æ¥è¿è¡Œ
python main.py

# æ–¹å¼2: ä½¿ç”¨uvicorn
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

#### 5. è®¿é—®APIæ–‡æ¡£
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### Dockeréƒ¨ç½²

#### 1. Dockerfile
```dockerfile
FROM python:3.9-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    default-libmysqlclient-dev \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£…Pythonä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### 2. docker-compose.yml
```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: mall_mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: online_mall
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database:/docker-entrypoint-initdb.d
    networks:
      - mall_network

  backend:
    build: ./backend
    container_name: mall_backend
    environment:
      DATABASE_URL: mysql+pymysql://root:root123@mysql:3306/online_mall
    ports:
      - "8000:8000"
    depends_on:
      - mysql
    networks:
      - mall_network

volumes:
  mysql_data:

networks:
  mall_network:
    driver: bridge
```

#### 3. å¯åŠ¨DockeræœåŠ¡
```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend

# åœæ­¢æœåŠ¡
docker-compose down
```

---

## æµ‹è¯•æŒ‡å—

### è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
```bash
cd backend
python test_api.py
```

æµ‹è¯•è¦†ç›–ï¼š
1. âœ… å¥åº·æ£€æŸ¥
2. âœ… ç”¨æˆ·æ³¨å†Œ
3. âœ… ç”¨æˆ·ç™»å½•
4. âœ… å•†å®¶ç™»å½•
5. âœ… è·å–å•†å“åˆ—è¡¨
6. âœ… è·å–çƒ­é”€å•†å“
7. âœ… åˆ›å»ºè®¢å•
8. âœ… è·å–ä¸ªæ€§åŒ–æ¨è
9. âœ… é”€å”®è¶‹åŠ¿ç»Ÿè®¡
10. âœ… AIç»è¥å»ºè®®

### ä½¿ç”¨Swaggeræµ‹è¯•

1. è®¿é—® http://localhost:8000/docs
2. ç‚¹å‡»"Try it out"
3. å¡«å†™å‚æ•°
4. ç‚¹å‡»"Execute"
5. æŸ¥çœ‹å“åº”ç»“æœ

### ä½¿ç”¨Postmanæµ‹è¯•

å¯¼å…¥API Collectionï¼š
```json
{
  "info": {
    "name": "ç½‘ä¸Šå•†åŸAPI",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [...]
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–
- âœ… ç´¢å¼•è¦†ç›–å¸¸ç”¨æŸ¥è¯¢å­—æ®µ
- âœ… ä½¿ç”¨è¿æ¥æ± ç®¡ç†è¿æ¥
- âœ… å¯ç”¨æŸ¥è¯¢ç¼“å­˜
- âœ… å®šæœŸåˆ†ææ…¢æŸ¥è¯¢

### 2. åº”ç”¨ä¼˜åŒ–
- âœ… ä½¿ç”¨å¼‚æ­¥æ•°æ®åº“æ“ä½œ
- âœ… å®ç°æ¥å£é™æµ
- âœ… æ·»åŠ Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
- âœ… ä¼˜åŒ–AIç®—æ³•è®¡ç®—

### 3. éƒ¨ç½²ä¼˜åŒ–
- âœ… ä½¿ç”¨Gunicornå¤šè¿›ç¨‹éƒ¨ç½²
- âœ… é…ç½®Nginxåå‘ä»£ç†
- âœ… å¯ç”¨Gzipå‹ç¼©
- âœ… CDNåŠ é€Ÿé™æ€èµ„æº

---

## å®‰å…¨æªæ–½

### 1. è®¤è¯å®‰å…¨
- âœ… JWT Tokenè®¤è¯
- âœ… Tokenè¿‡æœŸæ—¶é—´é™åˆ¶ï¼ˆ24å°æ—¶ï¼‰
- âœ… bcryptå¯†ç åŠ å¯†ï¼ˆcost=12ï¼‰

### 2. æ•°æ®å®‰å…¨
- âœ… SQLæ³¨å…¥é˜²æŠ¤ï¼ˆORMå‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- âœ… XSSé˜²æŠ¤ï¼ˆè¾“å…¥éªŒè¯ï¼‰
- âœ… CORSè·¨åŸŸé™åˆ¶

### 3. ä¸šåŠ¡å®‰å…¨
- âœ… åº“å­˜æ£€æŸ¥é˜²æ­¢è¶…å–
- âœ… è®¢å•äº‹åŠ¡å¤„ç†
- âœ… æ¥å£è®¿é—®æƒé™æ§åˆ¶

---

## æŠ€æœ¯äº®ç‚¹æ€»ç»“

### 1. AIç®—æ³•çœŸå®å®ç° â­â­â­â­â­
- å®Œæ•´å®ç°Item-BasedååŒè¿‡æ»¤
- 6æ¡æ™ºèƒ½è§„åˆ™å¼•æ“
- å¤šç»´åº¦æ•°æ®åˆ†æ

### 2. å·¥ç¨‹åŒ–æ ‡å‡† â­â­â­â­â­
- åˆ†å±‚æ¶æ„è®¾è®¡
- ä¾èµ–æ³¨å…¥æ¨¡å¼
- å®Œæ•´å¼‚å¸¸å¤„ç†
- è‡ªåŠ¨åŒ–æµ‹è¯•

### 3. æ€§èƒ½ä¼˜åŒ– â­â­â­â­
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- è¿æ¥æ± ç®¡ç†
- æŸ¥è¯¢ä¼˜åŒ–

### 4. å®‰å…¨å¯é  â­â­â­â­â­
- JWTè®¤è¯
- å¯†ç åŠ å¯†
- SQLæ³¨å…¥é˜²æŠ¤
- äº‹åŠ¡å¤„ç†

---

**æœ¬æ–‡æ¡£æä¾›äº†å®Œæ•´çš„åç«¯æŠ€æœ¯å®ç°æ–¹æ¡ˆï¼Œæ¶µç›–æ¶æ„è®¾è®¡ã€æ ¸å¿ƒæ¨¡å—ã€AIç®—æ³•ã€APIæ¥å£ã€éƒ¨ç½²æ–¹æ¡ˆç­‰æ‰€æœ‰æ–¹é¢ã€‚**
